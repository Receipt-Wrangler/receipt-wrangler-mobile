import { map, filter } from 'rxjs/operators';
import { getActionTypeFromInstance } from '../utils/utils';
/**
 * RxJS operator for selecting out specific actions.
 *
 * This will grab actions that have just been dispatched as well as actions that have completed
 */
export function ofAction(...allowedTypes) {
    return ofActionOperator(allowedTypes);
}
/**
 * RxJS operator for selecting out specific actions.
 *
 * This will ONLY grab actions that have just been dispatched
 */
export function ofActionDispatched(...allowedTypes) {
    return ofActionOperator(allowedTypes, ["DISPATCHED" /* Dispatched */]);
}
/**
 * RxJS operator for selecting out specific actions.
 *
 * This will ONLY grab actions that have just been successfully completed
 */
export function ofActionSuccessful(...allowedTypes) {
    return ofActionOperator(allowedTypes, ["SUCCESSFUL" /* Successful */]);
}
/**
 * RxJS operator for selecting out specific actions.
 *
 * This will ONLY grab actions that have just been canceled
 */
export function ofActionCanceled(...allowedTypes) {
    return ofActionOperator(allowedTypes, ["CANCELED" /* Canceled */]);
}
/**
 * RxJS operator for selecting out specific actions.
 *
 * This will ONLY grab actions that have just been completed
 */
export function ofActionCompleted(...allowedTypes) {
    const allowedStatuses = [
        "SUCCESSFUL" /* Successful */,
        "CANCELED" /* Canceled */,
        "ERRORED" /* Errored */
    ];
    return ofActionOperator(allowedTypes, allowedStatuses, mapActionResult);
}
/**
 * RxJS operator for selecting out specific actions.
 *
 * This will ONLY grab actions that have just thrown an error
 */
export function ofActionErrored(...allowedTypes) {
    return ofActionOperator(allowedTypes, ["ERRORED" /* Errored */]);
}
function ofActionOperator(allowedTypes, statuses, 
// This actually could've been `OperatorFunction<ActionContext, ActionCompletion | any>`,
// since it maps either to `ctx.action` OR to `ActionCompletion`. But `ActionCompleteion | any`
// defaults to `any`, thus there is no sense from union type.
mapOperator = mapAction) {
    const allowedMap = createAllowedActionTypesMap(allowedTypes);
    const allowedStatusMap = statuses && createAllowedStatusesMap(statuses);
    return function (o) {
        return o.pipe(filterStatus(allowedMap, allowedStatusMap), mapOperator());
    };
}
function filterStatus(allowedTypes, allowedStatuses) {
    return filter((ctx) => {
        const actionType = getActionTypeFromInstance(ctx.action);
        const typeMatch = allowedTypes[actionType];
        const statusMatch = allowedStatuses ? allowedStatuses[ctx.status] : true;
        return typeMatch && statusMatch;
    });
}
function mapActionResult() {
    return map(({ action, status, error }) => {
        return {
            action,
            result: {
                successful: "SUCCESSFUL" /* Successful */ === status,
                canceled: "CANCELED" /* Canceled */ === status,
                error
            }
        };
    });
}
function mapAction() {
    return map((ctx) => ctx.action);
}
function createAllowedActionTypesMap(types) {
    return types.reduce((filterMap, klass) => {
        filterMap[getActionTypeFromInstance(klass)] = true;
        return filterMap;
    }, {});
}
function createAllowedStatusesMap(statuses) {
    return statuses.reduce((filterMap, status) => {
        filterMap[status] = true;
        return filterMap;
    }, {});
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2YtYWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvc3RvcmUvc3JjL29wZXJhdG9ycy9vZi1hY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUc3QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQXNCM0Q7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxRQUFRLENBQ3RCLEdBQUcsWUFBZTtJQUtsQixPQUFPLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3hDLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsTUFBTSxVQUFVLGtCQUFrQixDQUNoQyxHQUFHLFlBQWU7SUFLbEIsT0FBTyxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUUsK0JBQXlCLENBQUMsQ0FBQztBQUNuRSxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxrQkFBa0IsQ0FDaEMsR0FBRyxZQUFlO0lBS2xCLE9BQU8sZ0JBQWdCLENBQUMsWUFBWSxFQUFFLCtCQUF5QixDQUFDLENBQUM7QUFDbkUsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsZ0JBQWdCLENBQzlCLEdBQUcsWUFBZTtJQUtsQixPQUFPLGdCQUFnQixDQUFDLFlBQVksRUFBRSwyQkFBdUIsQ0FBQyxDQUFDO0FBQ2pFLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsTUFBTSxVQUFVLGlCQUFpQixDQUMvQixHQUFHLFlBQWU7SUFLbEIsTUFBTSxlQUFlLEdBQUc7Ozs7S0FJdkIsQ0FBQztJQUNGLE9BQU8sZ0JBQWdCLENBQUMsWUFBWSxFQUFFLGVBQWUsRUFBRSxlQUFlLENBQUMsQ0FBQztBQUMxRSxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxlQUFlLENBQzdCLEdBQUcsWUFBZTtJQUtsQixPQUFPLGdCQUFnQixDQUFDLFlBQVksRUFBRSx5QkFBc0IsQ0FBQyxDQUFDO0FBQ2hFLENBQUM7QUFFRCxTQUFTLGdCQUFnQixDQUN2QixZQUEwQixFQUMxQixRQUF5QjtBQUN6Qix5RkFBeUY7QUFDekYsK0ZBQStGO0FBQy9GLDZEQUE2RDtBQUM3RCxjQUEwRCxTQUFTO0lBRW5FLE1BQU0sVUFBVSxHQUFHLDJCQUEyQixDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzdELE1BQU0sZ0JBQWdCLEdBQUcsUUFBUSxJQUFJLHdCQUF3QixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hFLE9BQU8sVUFBUyxDQUE0QjtRQUMxQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUM7SUFDM0UsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsWUFBWSxDQUFDLFlBQXVCLEVBQUUsZUFBMkI7SUFDeEUsT0FBTyxNQUFNLENBQUMsQ0FBQyxHQUFrQixFQUFFLEVBQUU7UUFDbkMsTUFBTSxVQUFVLEdBQUcseUJBQXlCLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBRSxDQUFDO1FBQzFELE1BQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMzQyxNQUFNLFdBQVcsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUN6RSxPQUFPLFNBQVMsSUFBSSxXQUFXLENBQUM7SUFDbEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxlQUFlO0lBQ3RCLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBaUIsRUFBRSxFQUFFO1FBQ3RELE9BQXlCO1lBQ3ZCLE1BQU07WUFDTixNQUFNLEVBQUU7Z0JBQ04sVUFBVSxFQUFFLGtDQUE0QixNQUFNO2dCQUM5QyxRQUFRLEVBQUUsOEJBQTBCLE1BQU07Z0JBQzFDLEtBQUs7YUFDTjtTQUNGLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxTQUFTLFNBQVM7SUFDaEIsT0FBTyxHQUFHLENBQUMsQ0FBQyxHQUFrQixFQUFFLEVBQUUsQ0FBSSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDcEQsQ0FBQztBQU1ELFNBQVMsMkJBQTJCLENBQUMsS0FBbUI7SUFDdEQsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBb0IsRUFBRSxLQUFVLEVBQUUsRUFBRTtRQUN2RCxTQUFTLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDcEQsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQyxFQUFhLEVBQUUsQ0FBQyxDQUFDO0FBQ3BCLENBQUM7QUFFRCxTQUFTLHdCQUF3QixDQUFDLFFBQXdCO0lBQ3hELE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQW9CLEVBQUUsTUFBb0IsRUFBRSxFQUFFO1FBQ3BFLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDekIsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQyxFQUFhLEVBQUUsQ0FBQyxDQUFDO0FBQ3BCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcGVyYXRvckZ1bmN0aW9uLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgQWN0aW9uVHlwZSB9IGZyb20gJy4uL2FjdGlvbnMvc3ltYm9scyc7XG5pbXBvcnQgeyBnZXRBY3Rpb25UeXBlRnJvbUluc3RhbmNlIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgQWN0aW9uQ29udGV4dCwgQWN0aW9uU3RhdHVzIH0gZnJvbSAnLi4vYWN0aW9ucy1zdHJlYW0nO1xuXG50eXBlIFR1cGxlS2V5czxUIGV4dGVuZHMgYW55W10+ID0gRXhjbHVkZTxrZXlvZiBULCBrZXlvZiBbXT47XG5cbi8qKlxuICogR2l2ZW4gYSBQT0pPLCByZXR1cm5zIHRoZSBQT0pPIHR5cGUsIGdpdmVuIGEgY2xhc3MgY29uc3RydWN0b3Igb2JqZWN0LCByZXR1cm5zIHRoZSB0eXBlIG9mIHRoZSBjbGFzcy5cbiAqXG4gKiBUaGlzIHV0aWxpdHkgdHlwZSBleGlzdHMgZHVlIHRvIHRoZSBjb21wbGV4aXR5IG9mIEFjdGlvblR5cGUgYmVpbmcgZWl0aGVyIGFuIEFjdGlvbkRlZiBjbGFzcyBvciB0aGUgcGxhaW5cbiAqIGB7IHR5cGU6IHN0cmluZyB9YCB0eXBlIChvciBzaW1pbGFyIGNvbXBhdGlibGUgUE9KTyB0eXBlcykuXG4gKi9cbnR5cGUgQ29uc3RydWN0ZWQ8VD4gPSBUIGV4dGVuZHMgbmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gaW5mZXIgVSA/IFUgOiBUO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFjdGlvbkNvbXBsZXRpb248VCA9IGFueSwgRSA9IEVycm9yPiB7XG4gIGFjdGlvbjogVDtcbiAgcmVzdWx0OiB7XG4gICAgc3VjY2Vzc2Z1bDogYm9vbGVhbjtcbiAgICBjYW5jZWxlZDogYm9vbGVhbjtcbiAgICBlcnJvcj86IEU7XG4gIH07XG59XG5cbi8qKlxuICogUnhKUyBvcGVyYXRvciBmb3Igc2VsZWN0aW5nIG91dCBzcGVjaWZpYyBhY3Rpb25zLlxuICpcbiAqIFRoaXMgd2lsbCBncmFiIGFjdGlvbnMgdGhhdCBoYXZlIGp1c3QgYmVlbiBkaXNwYXRjaGVkIGFzIHdlbGwgYXMgYWN0aW9ucyB0aGF0IGhhdmUgY29tcGxldGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvZkFjdGlvbjxUIGV4dGVuZHMgQWN0aW9uVHlwZVtdPihcbiAgLi4uYWxsb3dlZFR5cGVzOiBUXG4pOiBPcGVyYXRvckZ1bmN0aW9uPFxuICBBY3Rpb25Db250ZXh0PENvbnN0cnVjdGVkPFRbVHVwbGVLZXlzPFQ+XT4+LFxuICBDb25zdHJ1Y3RlZDxUW1R1cGxlS2V5czxUPl0+XG4+IHtcbiAgcmV0dXJuIG9mQWN0aW9uT3BlcmF0b3IoYWxsb3dlZFR5cGVzKTtcbn1cblxuLyoqXG4gKiBSeEpTIG9wZXJhdG9yIGZvciBzZWxlY3Rpbmcgb3V0IHNwZWNpZmljIGFjdGlvbnMuXG4gKlxuICogVGhpcyB3aWxsIE9OTFkgZ3JhYiBhY3Rpb25zIHRoYXQgaGF2ZSBqdXN0IGJlZW4gZGlzcGF0Y2hlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gb2ZBY3Rpb25EaXNwYXRjaGVkPFQgZXh0ZW5kcyBBY3Rpb25UeXBlW10+KFxuICAuLi5hbGxvd2VkVHlwZXM6IFRcbik6IE9wZXJhdG9yRnVuY3Rpb248XG4gIEFjdGlvbkNvbnRleHQ8Q29uc3RydWN0ZWQ8VFtUdXBsZUtleXM8VD5dPj4sXG4gIENvbnN0cnVjdGVkPFRbVHVwbGVLZXlzPFQ+XT5cbj4ge1xuICByZXR1cm4gb2ZBY3Rpb25PcGVyYXRvcihhbGxvd2VkVHlwZXMsIFtBY3Rpb25TdGF0dXMuRGlzcGF0Y2hlZF0pO1xufVxuXG4vKipcbiAqIFJ4SlMgb3BlcmF0b3IgZm9yIHNlbGVjdGluZyBvdXQgc3BlY2lmaWMgYWN0aW9ucy5cbiAqXG4gKiBUaGlzIHdpbGwgT05MWSBncmFiIGFjdGlvbnMgdGhhdCBoYXZlIGp1c3QgYmVlbiBzdWNjZXNzZnVsbHkgY29tcGxldGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvZkFjdGlvblN1Y2Nlc3NmdWw8VCBleHRlbmRzIEFjdGlvblR5cGVbXT4oXG4gIC4uLmFsbG93ZWRUeXBlczogVFxuKTogT3BlcmF0b3JGdW5jdGlvbjxcbiAgQWN0aW9uQ29udGV4dDxDb25zdHJ1Y3RlZDxUW1R1cGxlS2V5czxUPl0+PixcbiAgQ29uc3RydWN0ZWQ8VFtUdXBsZUtleXM8VD5dPlxuPiB7XG4gIHJldHVybiBvZkFjdGlvbk9wZXJhdG9yKGFsbG93ZWRUeXBlcywgW0FjdGlvblN0YXR1cy5TdWNjZXNzZnVsXSk7XG59XG5cbi8qKlxuICogUnhKUyBvcGVyYXRvciBmb3Igc2VsZWN0aW5nIG91dCBzcGVjaWZpYyBhY3Rpb25zLlxuICpcbiAqIFRoaXMgd2lsbCBPTkxZIGdyYWIgYWN0aW9ucyB0aGF0IGhhdmUganVzdCBiZWVuIGNhbmNlbGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvZkFjdGlvbkNhbmNlbGVkPFQgZXh0ZW5kcyBBY3Rpb25UeXBlW10+KFxuICAuLi5hbGxvd2VkVHlwZXM6IFRcbik6IE9wZXJhdG9yRnVuY3Rpb248XG4gIEFjdGlvbkNvbnRleHQ8Q29uc3RydWN0ZWQ8VFtUdXBsZUtleXM8VD5dPj4sXG4gIENvbnN0cnVjdGVkPFRbVHVwbGVLZXlzPFQ+XT5cbj4ge1xuICByZXR1cm4gb2ZBY3Rpb25PcGVyYXRvcihhbGxvd2VkVHlwZXMsIFtBY3Rpb25TdGF0dXMuQ2FuY2VsZWRdKTtcbn1cblxuLyoqXG4gKiBSeEpTIG9wZXJhdG9yIGZvciBzZWxlY3Rpbmcgb3V0IHNwZWNpZmljIGFjdGlvbnMuXG4gKlxuICogVGhpcyB3aWxsIE9OTFkgZ3JhYiBhY3Rpb25zIHRoYXQgaGF2ZSBqdXN0IGJlZW4gY29tcGxldGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvZkFjdGlvbkNvbXBsZXRlZDxUIGV4dGVuZHMgQWN0aW9uVHlwZVtdPihcbiAgLi4uYWxsb3dlZFR5cGVzOiBUXG4pOiBPcGVyYXRvckZ1bmN0aW9uPFxuICBBY3Rpb25Db250ZXh0PENvbnN0cnVjdGVkPFRbVHVwbGVLZXlzPFQ+XT4+LFxuICBBY3Rpb25Db21wbGV0aW9uPENvbnN0cnVjdGVkPFRbVHVwbGVLZXlzPFQ+XT4+XG4+IHtcbiAgY29uc3QgYWxsb3dlZFN0YXR1c2VzID0gW1xuICAgIEFjdGlvblN0YXR1cy5TdWNjZXNzZnVsLFxuICAgIEFjdGlvblN0YXR1cy5DYW5jZWxlZCxcbiAgICBBY3Rpb25TdGF0dXMuRXJyb3JlZFxuICBdO1xuICByZXR1cm4gb2ZBY3Rpb25PcGVyYXRvcihhbGxvd2VkVHlwZXMsIGFsbG93ZWRTdGF0dXNlcywgbWFwQWN0aW9uUmVzdWx0KTtcbn1cblxuLyoqXG4gKiBSeEpTIG9wZXJhdG9yIGZvciBzZWxlY3Rpbmcgb3V0IHNwZWNpZmljIGFjdGlvbnMuXG4gKlxuICogVGhpcyB3aWxsIE9OTFkgZ3JhYiBhY3Rpb25zIHRoYXQgaGF2ZSBqdXN0IHRocm93biBhbiBlcnJvclxuICovXG5leHBvcnQgZnVuY3Rpb24gb2ZBY3Rpb25FcnJvcmVkPFQgZXh0ZW5kcyBBY3Rpb25UeXBlW10+KFxuICAuLi5hbGxvd2VkVHlwZXM6IFRcbik6IE9wZXJhdG9yRnVuY3Rpb248XG4gIEFjdGlvbkNvbnRleHQ8Q29uc3RydWN0ZWQ8VFtUdXBsZUtleXM8VD5dPj4sXG4gIENvbnN0cnVjdGVkPFRbVHVwbGVLZXlzPFQ+XT5cbj4ge1xuICByZXR1cm4gb2ZBY3Rpb25PcGVyYXRvcihhbGxvd2VkVHlwZXMsIFtBY3Rpb25TdGF0dXMuRXJyb3JlZF0pO1xufVxuXG5mdW5jdGlvbiBvZkFjdGlvbk9wZXJhdG9yKFxuICBhbGxvd2VkVHlwZXM6IEFjdGlvblR5cGVbXSxcbiAgc3RhdHVzZXM/OiBBY3Rpb25TdGF0dXNbXSxcbiAgLy8gVGhpcyBhY3R1YWxseSBjb3VsZCd2ZSBiZWVuIGBPcGVyYXRvckZ1bmN0aW9uPEFjdGlvbkNvbnRleHQsIEFjdGlvbkNvbXBsZXRpb24gfCBhbnk+YCxcbiAgLy8gc2luY2UgaXQgbWFwcyBlaXRoZXIgdG8gYGN0eC5hY3Rpb25gIE9SIHRvIGBBY3Rpb25Db21wbGV0aW9uYC4gQnV0IGBBY3Rpb25Db21wbGV0ZWlvbiB8IGFueWBcbiAgLy8gZGVmYXVsdHMgdG8gYGFueWAsIHRodXMgdGhlcmUgaXMgbm8gc2Vuc2UgZnJvbSB1bmlvbiB0eXBlLlxuICBtYXBPcGVyYXRvcjogKCkgPT4gT3BlcmF0b3JGdW5jdGlvbjxBY3Rpb25Db250ZXh0LCBhbnk+ID0gbWFwQWN0aW9uXG4pOiBPcGVyYXRvckZ1bmN0aW9uPEFjdGlvbkNvbnRleHQsIGFueT4ge1xuICBjb25zdCBhbGxvd2VkTWFwID0gY3JlYXRlQWxsb3dlZEFjdGlvblR5cGVzTWFwKGFsbG93ZWRUeXBlcyk7XG4gIGNvbnN0IGFsbG93ZWRTdGF0dXNNYXAgPSBzdGF0dXNlcyAmJiBjcmVhdGVBbGxvd2VkU3RhdHVzZXNNYXAoc3RhdHVzZXMpO1xuICByZXR1cm4gZnVuY3Rpb24obzogT2JzZXJ2YWJsZTxBY3Rpb25Db250ZXh0Pikge1xuICAgIHJldHVybiBvLnBpcGUoZmlsdGVyU3RhdHVzKGFsbG93ZWRNYXAsIGFsbG93ZWRTdGF0dXNNYXApLCBtYXBPcGVyYXRvcigpKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZmlsdGVyU3RhdHVzKGFsbG93ZWRUeXBlczogRmlsdGVyTWFwLCBhbGxvd2VkU3RhdHVzZXM/OiBGaWx0ZXJNYXApIHtcbiAgcmV0dXJuIGZpbHRlcigoY3R4OiBBY3Rpb25Db250ZXh0KSA9PiB7XG4gICAgY29uc3QgYWN0aW9uVHlwZSA9IGdldEFjdGlvblR5cGVGcm9tSW5zdGFuY2UoY3R4LmFjdGlvbikhO1xuICAgIGNvbnN0IHR5cGVNYXRjaCA9IGFsbG93ZWRUeXBlc1thY3Rpb25UeXBlXTtcbiAgICBjb25zdCBzdGF0dXNNYXRjaCA9IGFsbG93ZWRTdGF0dXNlcyA/IGFsbG93ZWRTdGF0dXNlc1tjdHguc3RhdHVzXSA6IHRydWU7XG4gICAgcmV0dXJuIHR5cGVNYXRjaCAmJiBzdGF0dXNNYXRjaDtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG1hcEFjdGlvblJlc3VsdCgpOiBPcGVyYXRvckZ1bmN0aW9uPEFjdGlvbkNvbnRleHQsIEFjdGlvbkNvbXBsZXRpb24+IHtcbiAgcmV0dXJuIG1hcCgoeyBhY3Rpb24sIHN0YXR1cywgZXJyb3IgfTogQWN0aW9uQ29udGV4dCkgPT4ge1xuICAgIHJldHVybiA8QWN0aW9uQ29tcGxldGlvbj57XG4gICAgICBhY3Rpb24sXG4gICAgICByZXN1bHQ6IHtcbiAgICAgICAgc3VjY2Vzc2Z1bDogQWN0aW9uU3RhdHVzLlN1Y2Nlc3NmdWwgPT09IHN0YXR1cyxcbiAgICAgICAgY2FuY2VsZWQ6IEFjdGlvblN0YXR1cy5DYW5jZWxlZCA9PT0gc3RhdHVzLFxuICAgICAgICBlcnJvclxuICAgICAgfVxuICAgIH07XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBtYXBBY3Rpb248VCA9IGFueT4oKTogT3BlcmF0b3JGdW5jdGlvbjxBY3Rpb25Db250ZXh0LCBUPiB7XG4gIHJldHVybiBtYXAoKGN0eDogQWN0aW9uQ29udGV4dCkgPT4gPFQ+Y3R4LmFjdGlvbik7XG59XG5cbmludGVyZmFjZSBGaWx0ZXJNYXAge1xuICBba2V5OiBzdHJpbmddOiBib29sZWFuO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbGxvd2VkQWN0aW9uVHlwZXNNYXAodHlwZXM6IEFjdGlvblR5cGVbXSk6IEZpbHRlck1hcCB7XG4gIHJldHVybiB0eXBlcy5yZWR1Y2UoKGZpbHRlck1hcDogRmlsdGVyTWFwLCBrbGFzczogYW55KSA9PiB7XG4gICAgZmlsdGVyTWFwW2dldEFjdGlvblR5cGVGcm9tSW5zdGFuY2Uoa2xhc3MpIV0gPSB0cnVlO1xuICAgIHJldHVybiBmaWx0ZXJNYXA7XG4gIH0sIDxGaWx0ZXJNYXA+e30pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbGxvd2VkU3RhdHVzZXNNYXAoc3RhdHVzZXM6IEFjdGlvblN0YXR1c1tdKTogRmlsdGVyTWFwIHtcbiAgcmV0dXJuIHN0YXR1c2VzLnJlZHVjZSgoZmlsdGVyTWFwOiBGaWx0ZXJNYXAsIHN0YXR1czogQWN0aW9uU3RhdHVzKSA9PiB7XG4gICAgZmlsdGVyTWFwW3N0YXR1c10gPSB0cnVlO1xuICAgIHJldHVybiBmaWx0ZXJNYXA7XG4gIH0sIDxGaWx0ZXJNYXA+e30pO1xufVxuIl19