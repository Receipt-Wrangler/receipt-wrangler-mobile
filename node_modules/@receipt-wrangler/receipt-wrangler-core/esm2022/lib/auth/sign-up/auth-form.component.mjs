import { Component, EventEmitter, Input, Output, TemplateRef, } from '@angular/core';
import { FormBuilder, FormControl, FormGroup, Validators, } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { Store } from '@ngxs/store';
import { BehaviorSubject, take, tap } from 'rxjs';
import { GroupState } from '../../store/group.state';
import { UserValidators } from '../../validators/user-validators';
import { AuthFormUtil } from './auth-form.util';
import * as i0 from "@angular/core";
import * as i1 from "./auth-form.util";
import * as i2 from "@angular/forms";
import * as i3 from "@angular/router";
import * as i4 from "@ngxs/store";
import * as i5 from "../../validators/user-validators";
import * as i6 from "../../button/button/button.component";
import * as i7 from "@angular/common";
import * as i8 from "../../directives/feature.directive";
import * as i9 from "../../input/input/input.component";
import * as i10 from "../../pipes/form-get.pipe";
class AuthForm {
    constructor(authFormUtil, formBuilder, route, router, store, userValidators) {
        this.authFormUtil = authFormUtil;
        this.formBuilder = formBuilder;
        this.route = route;
        this.router = router;
        this.store = store;
        this.userValidators = userValidators;
        this.emitSubmit = false;
        this.submitted = new EventEmitter();
        this.form = new FormGroup({});
        this.isSignUp = new BehaviorSubject(false);
        this.headerText = '';
        this.primaryButtonText = '';
        this.secondaryButtonText = '';
        this.secondaryButtonRouterLink = [];
    }
    ngOnInit() {
        this.initForm();
        this.listenForRouteChanges();
        this.listenForIsSignUpChanges();
    }
    listenForRouteChanges() {
        this.route.data
            .pipe(tap((data) => {
            this.isSignUp.next(!!data?.['isSignUp']);
        }))
            .subscribe();
    }
    listenForIsSignUpChanges() {
        this.isSignUp
            .pipe(tap((isSignUp) => {
            if (isSignUp) {
                this.headerText = 'Sign Up';
                this.primaryButtonText = 'Sign Up';
                this.secondaryButtonRouterLink = ['/auth/login'];
                this.secondaryButtonText = 'Back to Login';
                this.form
                    .get('username')
                    ?.addAsyncValidators(this.userValidators.uniqueUsername(0, ''));
                this.form.addControl('displayname', new FormControl('', Validators.required));
            }
            else {
                this.headerText = 'Login';
                this.primaryButtonText = 'Login';
                this.secondaryButtonRouterLink = ['/auth/sign-up'];
                this.secondaryButtonText = 'Sign Up';
                this.form
                    .get('username')
                    ?.removeAsyncValidators(this.userValidators.uniqueUsername(0, ''));
                this.form.removeControl('displayname');
            }
        }))
            .subscribe();
    }
    initForm() {
        this.form = this.formBuilder.group({
            username: ['', [Validators.required]],
            password: ['', Validators.required],
        });
    }
    submit() {
        if (this.emitSubmit) {
            this.submitted.emit();
        }
        else {
            const isSignUp = this.isSignUp.getValue();
            this.authFormUtil
                .getSubmitObservable(this.form, isSignUp)
                .pipe(take(1), tap(() => {
                this.router.navigate([
                    this.store.selectSnapshot(GroupState.dashboardLink),
                ]);
            }))
                .subscribe();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.11", ngImport: i0, type: AuthForm, deps: [{ token: i1.AuthFormUtil }, { token: i2.FormBuilder }, { token: i3.ActivatedRoute }, { token: i3.Router }, { token: i4.Store }, { token: i5.UserValidators }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.11", type: AuthForm, selector: "app-auth-form", inputs: { additionalFieldsTemplate: "additionalFieldsTemplate", emitSubmit: "emitSubmit" }, outputs: { submitted: "submitted" }, providers: [UserValidators], ngImport: i0, template: "<div class=\"d-flex align-items-center justify-content-center\">\n  <form [formGroup]=\"form\" (ngSubmit)=\"submit()\">\n    <h2>{{ headerText }}</h2>\n    <div class=\"d-flex flex-column\">\n      <ng-template\n        *ngIf=\"additionalFieldsTemplate\"\n        [ngTemplateOutlet]=\"additionalFieldsTemplate\"\n      ></ng-template>\n      <ng-container *ngIf=\"isSignUp | async\">\n        <app-input\n          label=\"Displayname\"\n          [inputFormControl]=\"form | formGet : 'displayname'\"\n        >\n        </app-input>\n      </ng-container>\n      <app-input\n        label=\"Username\"\n        [inputFormControl]=\"form | formGet : 'username'\"\n      >\n      </app-input>\n      <app-input\n        label=\"Password\"\n        type=\"password\"\n        [showVisibilityEye]=\"true\"\n        [inputFormControl]=\"form | formGet : 'password'\"\n      >\n      </app-input>\n    </div>\n    <div class=\"w-100 d-flex flex-column\">\n      <app-button\n        class=\"w-100\"\n        buttonClass=\"w-100 mb-2\"\n        type=\"submit\"\n        [buttonText]=\"primaryButtonText\"\n      ></app-button>\n      <app-button\n        *appFeature=\"'enableLocalSignUp'\"\n        class=\"w-100\"\n        buttonClass=\"w-100 \"\n        type=\"button\"\n        color=\"accent\"\n        [buttonText]=\"secondaryButtonText\"\n        [routerLink]=\"secondaryButtonRouterLink\"\n      ></app-button>\n    </div>\n  </form>\n</div>\n", styles: [""], dependencies: [{ kind: "directive", type: i3.RouterLink, selector: "[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "component", type: i6.ButtonComponent, selector: "app-button", inputs: ["buttonClass", "color", "buttonText", "type", "matButtonType", "icon", "customIcon", "disabled", "buttonRouterLink", "tooltip", "matBadgeContent", "matBadgeColor"], outputs: ["clicked"] }, { kind: "directive", type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i7.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i8.FeatureDirective, selector: "[appFeature]", inputs: ["appFeature"] }, { kind: "component", type: i9.InputComponent, selector: "app-input", inputs: ["inputId", "type", "showVisibilityEye", "isCurrency", "mask", "maskPrefix", "thousandSeparator"], outputs: ["inputBlur"] }, { kind: "directive", type: i2.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i2.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i2.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "pipe", type: i7.AsyncPipe, name: "async" }, { kind: "pipe", type: i10.FormGetPipe, name: "formGet" }] }); }
}
export { AuthForm };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.11", ngImport: i0, type: AuthForm, decorators: [{
            type: Component,
            args: [{ selector: 'app-auth-form', providers: [UserValidators], template: "<div class=\"d-flex align-items-center justify-content-center\">\n  <form [formGroup]=\"form\" (ngSubmit)=\"submit()\">\n    <h2>{{ headerText }}</h2>\n    <div class=\"d-flex flex-column\">\n      <ng-template\n        *ngIf=\"additionalFieldsTemplate\"\n        [ngTemplateOutlet]=\"additionalFieldsTemplate\"\n      ></ng-template>\n      <ng-container *ngIf=\"isSignUp | async\">\n        <app-input\n          label=\"Displayname\"\n          [inputFormControl]=\"form | formGet : 'displayname'\"\n        >\n        </app-input>\n      </ng-container>\n      <app-input\n        label=\"Username\"\n        [inputFormControl]=\"form | formGet : 'username'\"\n      >\n      </app-input>\n      <app-input\n        label=\"Password\"\n        type=\"password\"\n        [showVisibilityEye]=\"true\"\n        [inputFormControl]=\"form | formGet : 'password'\"\n      >\n      </app-input>\n    </div>\n    <div class=\"w-100 d-flex flex-column\">\n      <app-button\n        class=\"w-100\"\n        buttonClass=\"w-100 mb-2\"\n        type=\"submit\"\n        [buttonText]=\"primaryButtonText\"\n      ></app-button>\n      <app-button\n        *appFeature=\"'enableLocalSignUp'\"\n        class=\"w-100\"\n        buttonClass=\"w-100 \"\n        type=\"button\"\n        color=\"accent\"\n        [buttonText]=\"secondaryButtonText\"\n        [routerLink]=\"secondaryButtonRouterLink\"\n      ></app-button>\n    </div>\n  </form>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.AuthFormUtil }, { type: i2.FormBuilder }, { type: i3.ActivatedRoute }, { type: i3.Router }, { type: i4.Store }, { type: i5.UserValidators }]; }, propDecorators: { additionalFieldsTemplate: [{
                type: Input
            }], emitSubmit: [{
                type: Input
            }], submitted: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUvc3JjL2xpYi9hdXRoL3NpZ24tdXAvYXV0aC1mb3JtLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUvc3JjL2xpYi9hdXRoL3NpZ24tdXAvYXV0aC1mb3JtLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sV0FBVyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDTCxXQUFXLEVBQ1gsV0FBVyxFQUNYLFNBQVMsRUFDVCxVQUFVLEdBQ1gsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDcEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDbEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtCQUFrQixDQUFDOzs7Ozs7Ozs7Ozs7QUFFaEQsTUFNYSxRQUFRO0lBZ0JuQixZQUNZLFlBQTBCLEVBQzFCLFdBQXdCLEVBQ3hCLEtBQXFCLEVBQ3JCLE1BQWMsRUFDZCxLQUFZLEVBQ1osY0FBOEI7UUFMOUIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLFVB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LENBQUMsVUFBVSxFQUFFO1lBQ25CLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDdkI7YUFBTTtZQUNMLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFMUMsSUFBSSxDQUFDLFlBQVk7aUJBQ2QsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUM7aUJBQ3hDLElBQUksQ0FDSCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsR0FBRyxDQUFDLEdBQUcsRUFBRTtnQkFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztvQkFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQztpQkFDcEQsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQ0g7aUJBQ0EsU0FBUyxFQUFFLENBQUM7U0FDaEI7SUFDSCxDQUFDOytHQW5HVSxRQUFRO21HQUFSLFFBQVEseUtBRlIsQ0FBQyxjQUFjLENBQUMsMEJDekI3Qix3NkNBK0NBOztTRHBCYSxRQUFROzRGQUFSLFFBQVE7a0JBTnBCLFNBQVM7K0JBQ0UsZUFBZSxhQUdkLENBQUMsY0FBYyxDQUFDO2dPQUdYLHdCQUF3QjtzQkFBdkMsS0FBSztnQkFFVSxVQUFVO3NCQUF6QixLQUFLO2dCQUVXLFNBQVM7c0JBQXpCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBUZW1wbGF0ZVJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBGb3JtQnVpbGRlcixcbiAgRm9ybUNvbnRyb2wsXG4gIEZvcm1Hcm91cCxcbiAgVmFsaWRhdG9ycyxcbn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBTdG9yZSB9IGZyb20gJ0BuZ3hzL3N0b3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgdGFrZSwgdGFwIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBHcm91cFN0YXRlIH0gZnJvbSAnLi4vLi4vc3RvcmUvZ3JvdXAuc3RhdGUnO1xuaW1wb3J0IHsgVXNlclZhbGlkYXRvcnMgfSBmcm9tICcuLi8uLi92YWxpZGF0b3JzL3VzZXItdmFsaWRhdG9ycyc7XG5pbXBvcnQgeyBBdXRoRm9ybVV0aWwgfSBmcm9tICcuL2F1dGgtZm9ybS51dGlsJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXBwLWF1dGgtZm9ybScsXG4gIHRlbXBsYXRlVXJsOiAnLi9hdXRoLWZvcm0uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9hdXRoLWZvcm0uY29tcG9uZW50LnNjc3MnXSxcbiAgcHJvdmlkZXJzOiBbVXNlclZhbGlkYXRvcnNdLFxufSlcbmV4cG9ydCBjbGFzcyBBdXRoRm9ybSBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIHB1YmxpYyBhZGRpdGlvbmFsRmllbGRzVGVtcGxhdGU/OiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIEBJbnB1dCgpIHB1YmxpYyBlbWl0U3VibWl0OiBib29sZWFuID0gZmFsc2U7XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBzdWJtaXR0ZWQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBwdWJsaWMgZm9ybTogRm9ybUdyb3VwID0gbmV3IEZvcm1Hcm91cCh7fSk7XG4gIHB1YmxpYyBpc1NpZ25VcDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihcbiAgICBmYWxzZVxuICApO1xuICBwdWJsaWMgaGVhZGVyVGV4dDogc3RyaW5nID0gJyc7XG4gIHB1YmxpYyBwcmltYXJ5QnV0dG9uVGV4dDogc3RyaW5nID0gJyc7XG4gIHB1YmxpYyBzZWNvbmRhcnlCdXR0b25UZXh0OiBzdHJpbmcgPSAnJztcbiAgcHVibGljIHNlY29uZGFyeUJ1dHRvblJvdXRlckxpbms6IHN0cmluZ1tdID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGF1dGhGb3JtVXRpbDogQXV0aEZvcm1VdGlsLFxuICAgIHByb3RlY3RlZCBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgcHJvdGVjdGVkIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICBwcm90ZWN0ZWQgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJvdGVjdGVkIHN0b3JlOiBTdG9yZSxcbiAgICBwcm90ZWN0ZWQgdXNlclZhbGlkYXRvcnM6IFVzZXJWYWxpZGF0b3JzXG4gICkge31cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbml0Rm9ybSgpO1xuICAgIHRoaXMubGlzdGVuRm9yUm91dGVDaGFuZ2VzKCk7XG4gICAgdGhpcy5saXN0ZW5Gb3JJc1NpZ25VcENoYW5nZXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgbGlzdGVuRm9yUm91dGVDaGFuZ2VzKCk6IHZvaWQge1xuICAgIHRoaXMucm91dGUuZGF0YVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCgoZGF0YSkgPT4ge1xuICAgICAgICAgIHRoaXMuaXNTaWduVXAubmV4dCghIWRhdGE/LlsnaXNTaWduVXAnXSk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIGxpc3RlbkZvcklzU2lnblVwQ2hhbmdlcygpOiB2b2lkIHtcbiAgICB0aGlzLmlzU2lnblVwXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKChpc1NpZ25VcCkgPT4ge1xuICAgICAgICAgIGlmIChpc1NpZ25VcCkge1xuICAgICAgICAgICAgdGhpcy5oZWFkZXJUZXh0ID0gJ1NpZ24gVXAnO1xuICAgICAgICAgICAgdGhpcy5wcmltYXJ5QnV0dG9uVGV4dCA9ICdTaWduIFVwJztcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QnV0dG9uUm91dGVyTGluayA9IFsnL2F1dGgvbG9naW4nXTtcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QnV0dG9uVGV4dCA9ICdCYWNrIHRvIExvZ2luJztcbiAgICAgICAgICAgIHRoaXMuZm9ybVxuICAgICAgICAgICAgICAuZ2V0KCd1c2VybmFtZScpXG4gICAgICAgICAgICAgID8uYWRkQXN5bmNWYWxpZGF0b3JzKHRoaXMudXNlclZhbGlkYXRvcnMudW5pcXVlVXNlcm5hbWUoMCwgJycpKTtcbiAgICAgICAgICAgIHRoaXMuZm9ybS5hZGRDb250cm9sKFxuICAgICAgICAgICAgICAnZGlzcGxheW5hbWUnLFxuICAgICAgICAgICAgICBuZXcgRm9ybUNvbnRyb2woJycsIFZhbGlkYXRvcnMucmVxdWlyZWQpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhlYWRlclRleHQgPSAnTG9naW4nO1xuICAgICAgICAgICAgdGhpcy5wcmltYXJ5QnV0dG9uVGV4dCA9ICdMb2dpbic7XG4gICAgICAgICAgICB0aGlzLnNlY29uZGFyeUJ1dHRvblJvdXRlckxpbmsgPSBbJy9hdXRoL3NpZ24tdXAnXTtcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5QnV0dG9uVGV4dCA9ICdTaWduIFVwJztcbiAgICAgICAgICAgIHRoaXMuZm9ybVxuICAgICAgICAgICAgICAuZ2V0KCd1c2VybmFtZScpXG4gICAgICAgICAgICAgID8ucmVtb3ZlQXN5bmNWYWxpZGF0b3JzKFxuICAgICAgICAgICAgICAgIHRoaXMudXNlclZhbGlkYXRvcnMudW5pcXVlVXNlcm5hbWUoMCwgJycpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmZvcm0ucmVtb3ZlQ29udHJvbCgnZGlzcGxheW5hbWUnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRGb3JtKCk6IHZvaWQge1xuICAgIHRoaXMuZm9ybSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgdXNlcm5hbWU6IFsnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWRdXSxcbiAgICAgIHBhc3N3b3JkOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHN1Ym1pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5lbWl0U3VibWl0KSB7XG4gICAgICB0aGlzLnN1Ym1pdHRlZC5lbWl0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGlzU2lnblVwID0gdGhpcy5pc1NpZ25VcC5nZXRWYWx1ZSgpO1xuXG4gICAgICB0aGlzLmF1dGhGb3JtVXRpbFxuICAgICAgICAuZ2V0U3VibWl0T2JzZXJ2YWJsZSh0aGlzLmZvcm0sIGlzU2lnblVwKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YWtlKDEpLFxuICAgICAgICAgIHRhcCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXG4gICAgICAgICAgICAgIHRoaXMuc3RvcmUuc2VsZWN0U25hcHNob3QoR3JvdXBTdGF0ZS5kYXNoYm9hcmRMaW5rKSxcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICAgLnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImQtZmxleCBhbGlnbi1pdGVtcy1jZW50ZXIganVzdGlmeS1jb250ZW50LWNlbnRlclwiPlxuICA8Zm9ybSBbZm9ybUdyb3VwXT1cImZvcm1cIiAobmdTdWJtaXQpPVwic3VibWl0KClcIj5cbiAgICA8aDI+e3sgaGVhZGVyVGV4dCB9fTwvaDI+XG4gICAgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LWNvbHVtblwiPlxuICAgICAgPG5nLXRlbXBsYXRlXG4gICAgICAgICpuZ0lmPVwiYWRkaXRpb25hbEZpZWxkc1RlbXBsYXRlXCJcbiAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiYWRkaXRpb25hbEZpZWxkc1RlbXBsYXRlXCJcbiAgICAgID48L25nLXRlbXBsYXRlPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImlzU2lnblVwIHwgYXN5bmNcIj5cbiAgICAgICAgPGFwcC1pbnB1dFxuICAgICAgICAgIGxhYmVsPVwiRGlzcGxheW5hbWVcIlxuICAgICAgICAgIFtpbnB1dEZvcm1Db250cm9sXT1cImZvcm0gfCBmb3JtR2V0IDogJ2Rpc3BsYXluYW1lJ1wiXG4gICAgICAgID5cbiAgICAgICAgPC9hcHAtaW5wdXQ+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDxhcHAtaW5wdXRcbiAgICAgICAgbGFiZWw9XCJVc2VybmFtZVwiXG4gICAgICAgIFtpbnB1dEZvcm1Db250cm9sXT1cImZvcm0gfCBmb3JtR2V0IDogJ3VzZXJuYW1lJ1wiXG4gICAgICA+XG4gICAgICA8L2FwcC1pbnB1dD5cbiAgICAgIDxhcHAtaW5wdXRcbiAgICAgICAgbGFiZWw9XCJQYXNzd29yZFwiXG4gICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgIFtzaG93VmlzaWJpbGl0eUV5ZV09XCJ0cnVlXCJcbiAgICAgICAgW2lucHV0Rm9ybUNvbnRyb2xdPVwiZm9ybSB8IGZvcm1HZXQgOiAncGFzc3dvcmQnXCJcbiAgICAgID5cbiAgICAgIDwvYXBwLWlucHV0PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJ3LTEwMCBkLWZsZXggZmxleC1jb2x1bW5cIj5cbiAgICAgIDxhcHAtYnV0dG9uXG4gICAgICAgIGNsYXNzPVwidy0xMDBcIlxuICAgICAgICBidXR0b25DbGFzcz1cInctMTAwIG1iLTJcIlxuICAgICAgICB0eXBlPVwic3VibWl0XCJcbiAgICAgICAgW2J1dHRvblRleHRdPVwicHJpbWFyeUJ1dHRvblRleHRcIlxuICAgICAgPjwvYXBwLWJ1dHRvbj5cbiAgICAgIDxhcHAtYnV0dG9uXG4gICAgICAgICphcHBGZWF0dXJlPVwiJ2VuYWJsZUxvY2FsU2lnblVwJ1wiXG4gICAgICAgIGNsYXNzPVwidy0xMDBcIlxuICAgICAgICBidXR0b25DbGFzcz1cInctMTAwIFwiXG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICBjb2xvcj1cImFjY2VudFwiXG4gICAgICAgIFtidXR0b25UZXh0XT1cInNlY29uZGFyeUJ1dHRvblRleHRcIlxuICAgICAgICBbcm91dGVyTGlua109XCJzZWNvbmRhcnlCdXR0b25Sb3V0ZXJMaW5rXCJcbiAgICAgID48L2FwcC1idXR0b24+XG4gICAgPC9kaXY+XG4gIDwvZm9ybT5cbjwvZGl2PlxuIl19